from aiogram import Bot, types
from aiogram.dispatcher import Dispatcher
from aiogram.utils import executor
from aiogram.types import KeyboardButton, ReplyKeyboardMarkup, InlineKeyboardButton, InlineKeyboardMarkup, CallbackQuery, ReplyKeyboardRemove
from aiogram.utils.emoji import emojize
from aiogram.types.message import ContentType
from aiogram.utils.markdown import text, bold, italic, code, pre
from aiogram.types import ParseMode, ChatActions
from aiogram.dispatcher.filters import Text
from aiogram.contrib.fsm_storage.memory import MemoryStorage
from aiogram.dispatcher import FSMContext
from aiogram.dispatcher.filters.state import State, StatesGroup
import asyncio
import sqlite3
import os
import sys
import time
import random
import uuid
import datetime
###
sys.path.append('C:/Users/User/Desktop/DAY_PLAN')
from Useful_imports.Sqlite_imports import *
from Useful_imports.Date_imports import *
from Useful_imports.Basis_imports import *
from Useful_imports.Aiogram_imports import *
from Useful_imports.APIES import *

###
# –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è
bot = Bot(token=API_0)
storage = MemoryStorage()
dp = Dispatcher(bot, storage=storage)


###
# buttons&boards
x_reg = emojize(":rocket:–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø:rocket:")
x_aut = emojize(":airplane:–í–û–ô–¢–ò:airplane:")
x_reg_but = InlineKeyboardButton(x_reg, callback_data='reg')
x_aut_but = InlineKeyboardButton(x_aut, callback_data='aut')
regORaut_board = InlineKeyboardMarkup(resize_keyboard=True).add(x_aut_but).add(x_reg_but)
regORaut_text = text(emojize(":low_brightness:*–í—Ö–æ–¥ –≤ DAY PLAN*:low_brightness:\n\n"), code("|-|-|-|"),
                         emojize(
                             "\n\n:diamond_shape_with_a_dot_inside:–í–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —É—Å–ª—É–≥–∞–º DAY PLAN:diamond_shape_with_a_dot_inside:\n"))
reg_otmena_text = text(emojize(":rocket:–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø:rocket:\n\n‚ùå–û–¢–ú–ï–ù–ï–ù–û‚ùå"))
reg_otmena_text_2 = emojize(":rocket:–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø:rocket:\n\n‚ùå–ü–†–û–í–ê–õ–ï–ù–û‚ùå")
reg_otmena_text_3 = emojize(":rocket:–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø:rocket:\n\n‚ôªÔ∏è–ü–ï–†–ï–ó–ê–ü–£–©–ï–ù–û‚ôªÔ∏è")
appeal_board = InlineKeyboardMarkup().row(InlineKeyboardButton(("‚úîÔ∏è–î–ê‚úîÔ∏è"), callback_data="appeal_yes"),
                                              InlineKeyboardButton(("‚úñÔ∏è–ù–ï–¢‚úñÔ∏è"), callback_data="appeal_no"))
dopping_button = InlineKeyboardButton((f'‚ûñ'), callback_data=f'‚ûñ_reg')
dopping = InlineKeyboardMarkup(resize_keyboard=True).row(dopping_button, dopping_button, dopping_button)
reforming_appeal = InlineKeyboardButton((emojize("üîô–û–ë–†–ê–©–ï–ù–ò–ï")), callback_data='reforming_appeal')
reforming_login = InlineKeyboardButton((emojize("üîôÔ∏èÔ∏è–õ–û–ì–ò–ù")), callback_data='reforming_login')
reforming_pass = InlineKeyboardButton((emojize("üîôÔ∏è–ü–ê–†–û–õ–¨Ô∏è")), callback_data='reforming_pass')
reforming_reg = InlineKeyboardButton("üè¥–ü–†–û–ô–¢–ò –†–ï–ì–ò–°–¢–†–ê–¶–ò–Æ –ó–ê–ù–û–í–ûüè¥", callback_data='reforming_reg')
reforming_came = InlineKeyboardButton("–ù–ê–ó–ê–î‚Ü©Ô∏è", callback_data= 'come_ref_menu')
reforming_kb = InlineKeyboardMarkup(resize_keyboard=True).row(reforming_appeal, reforming_login, reforming_pass).add(reforming_reg).add(reforming_came)
control_bu_yes = InlineKeyboardButton((emojize("‚úîÔ∏è–î–ê‚úîÔ∏è")), callback_data='control_inform_yes')
control_bu_no = InlineKeyboardButton((emojize("‚úñÔ∏èÔ∏è–ù–ï–¢‚úñÔ∏èÔ∏è")), callback_data='control_inform_no')
kb_control = InlineKeyboardMarkup(resize_keyboard=True).add(control_bu_no).add(control_bu_yes)
aut_otmena_text = emojize(":airplane:–í–û–ô–¢–ò:airplane:\n\n‚ùå–û–¢–ú–ï–ù–ï–ù–û‚ùå")




# –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
n = 0
c = 0
number = 0
beta_number = 0
help_pass_list = []
pass_log_number = 0
number_for_afisha = 0
listi = []
listi_2 = []


# —Å—Ç–µ–π—Ç—ã
class Begin(StatesGroup):
    start = State()
    regORaut = State()


class Registor(StatesGroup):
    appeal = State()
    login = State()
    password = State()
    s_code = State()


class HelpC(StatesGroup):
    appeal = State()
    login = State()
    password = State()


class Authorization(StatesGroup):
    login = State()
    password = State()
    final = State()



###
# start_1: –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∫–æ–º–∞–Ω–¥–µ /start
@dp.message_handler(commands=['start'])
async def starting(message: types.Message):
    await Begin.start.set()
    username = message.from_user.username
    await bot.send_message(message.from_user.id, text(emojize(
        f":raised_hand:*–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, {username}!*:raised_hand:\n \t\t"
        f"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–π–¥–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –ø—Ä–µ–∂–¥–µ —á–µ–º –Ω–∞—á–∞—Ç—å —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é –±–æ—Ç–∞-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è DAY PLAN:\n \t\t/RegAut")),
                           parse_mode=ParseMode.MARKDOWN)


# start_2: –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∫–æ–º–∞–Ω–¥–µ /RegAth
@dp.message_handler(commands=['RegAut'], state=Begin.start)
async def regAndAth(message: types.Message):
    await Begin.next()
    x_reg = InlineKeyboardButton((emojize(":rocket:–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø:rocket:")), callback_data='reg')
    x_aut = InlineKeyboardButton((emojize(":airplane:–í–û–ô–¢–ò:airplane:")), callback_data='aut')
    chance = InlineKeyboardMarkup(resize_keyboard=True).add(x_aut).add(x_reg)
    await message.reply(text(emojize(":low_brightness:*–í—Ö–æ–¥ –≤ DAY PLAN*:low_brightness:\n\n"), code("|-|-|-|"), emojize(
        "\n\n:diamond_shape_with_a_dot_inside:–í–æ–π–¥–∏—Ç–µ –∏–ª–∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —É—Å–ª—É–≥–∞–º DAY PLAN:diamond_shape_with_a_dot_inside:\n")),
                        parse_mode=ParseMode.MARKDOWN, reply_markup=chance)


# start_3: –æ—Ç –ø–∏—à–µ—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ, –ø–æ–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∏—Å–ø–æ–ª–Ω–∏—Ç –∫–æ–º–∞–Ω–¥—É /RegAth
@dp.message_handler(state=Begin.start)
async def repetition_endless(message: types.Message):
    username = message.from_user.username
    await message.reply(text(emojize(
        f":raised_hand:*–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, {username}!*:raised_hand:\n \t\t"
        f"–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–π–¥–∏—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∏–ª–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –ø—Ä–µ–∂–¥–µ —á–µ–º –Ω–∞—á–∞—Ç—å —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—é –±–æ—Ç–∞-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è DAY PLAN:\n \t\t/RegAut")),
                        parse_mode=ParseMode.MARKDOWN)
###

###
# reg_0: –æ—Ç–º–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
@dp.message_handler(text=["‚≠ï–û–¢–ú–ï–ù–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò‚≠ï"], state = [Begin.regORaut, Registor.appeal, Registor.login, Registor.password, Registor.s_code, HelpC.appeal, HelpC.login, HelpC.password])
async def stoppingREG_1(message: types.Message, state: FSMContext):
    global number_for_afisha
    async with state.proxy() as data:
        vam = data['id_need']
    await sto(vam, message.message_id, message.from_user.id, reg_otmena_text, regORaut_text, regORaut_board)
    await state.finish()
    await Begin.regORaut.set()
    number_for_afisha = 0

# reg_1: –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ—Ç–µ–ª –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è
@dp.callback_query_handler(lambda c: c.data == 'reg', state=Begin.regORaut)
async def reag(callback_query: types.CallbackQuery, state: FSMContext):
    rg_stop_kb = ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True).add(KeyboardButton("‚≠ï–û–¢–ú–ï–ù–ê –†–ï–ì–ò–°–¢–†–ê–¶–ò–ò‚≠ï"))
    await callback_query.message.edit_text(
        (emojize(":rocket:–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø:rocket:")))
    await state.update_data(id_need=int(callback_query.message.message_id))
    await asyncio.sleep(0.3)
    await bot.send_message(callback_query.from_user.id, text(emojize("üîí‚ûñ*–† –ï –ì –ò –° –¢ –† –ê –¶ –ò –Ø*‚ûñüîí")),
                           parse_mode=ParseMode.MARKDOWN, reply_markup= rg_stop_kb)
    await asyncio.sleep(0.2)
    await bot.send_message(callback_query.from_user.id,
                           text=("üñ±*1/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî"),
                           reply_markup=appeal_board, parse_mode=ParseMode.MARKDOWN)
    await asyncio.sleep(0.3)


# reg_2: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ù–ï –∑–∞—Ö–æ—Ç–µ–ª –æ—Å–æ–±–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è
@dp.callback_query_handler(lambda c: c.data == 'appeal_no', state=Begin.regORaut)
async def appeal_no(callback_query: types.CallbackQuery, state: FSMContext):
    await Registor.login.set()
    username = callback_query.from_user.username
    await callback_query.message.edit_text(
        text(('üñ±*1/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:*'),
             (" ___–Ω–µ—Ç, –Ω–µ –Ω—É–∂–Ω–æ!___")), parse_mode=ParseMode.MARKDOWN)
    await asyncio.sleep(0.5)
    message_log = await bot.send_message(callback_query.from_user.id,
                                         text=(f'üñ±*2/5üñ±*\n\n‚ùïÔ∏è|–°–Ω–∞—á–∞–ª–∞, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ª–æ–≥–∏–Ω|‚ùï'),
                                         parse_mode=ParseMode.MARKDOWN)
    await state.update_data(mes_log=int(message_log.message_id))
    await state.update_data(id_need_1=int(callback_query.message.message_id))
    await asyncio.sleep(0.2)


# reg_3: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ—Ç–µ–ª –æ—Å–æ–±–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è
@dp.callback_query_handler(lambda c: c.data == 'appeal_yes', state=Begin.regORaut)
async def appeal_yes(callback_query: types.CallbackQuery, state: FSMContext):
    try:
        n = 0
        c = 0
        number = 1
        all_elements = []
        all_appeals = []
        username = callback_query.from_user.username
        global number_for_afisha
        await Registor.appeal.set()
        await asyncio.sleep(0.5)
        async with state.proxy() as data:
            message_ask = data.get('appeal')
        await state.update_data(id_need_0=int(callback_query.message.message_id))
        await callback_query.message.edit_text(f'üñ±*1/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî\n\n‚ñ´Ô∏è–ò –∫–∞–∫ —Ç—ã, {username}, —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –∫ —Ç–µ–±–µ –æ–±—Ä–∞—â–∞–ª–∏—Å—å?‚ñ´Ô∏è', parse_mode=ParseMode.MARKDOWN, reply_markup=dopping)
        elements_of_table_to_the_list('Day_Plan_db', 'All_appeals', all_elements)
        while n != len(all_elements):
            all_appeals.append(all_elements[n][0])
            n = n + 1
        while number_for_afisha == 0 and message_ask is None:
            try:
                async with state.proxy() as data:
                    if data.get('id_need_1') is None:
                        number = number + 1
                        n = n + 1
                        afisha = InlineKeyboardMarkup(resize_keyboard=True)
                        butt_1 = InlineKeyboardButton((f'{all_appeals[n - 1]}'), callback_data=f'{n - 1}_reg')
                        butt_2 = InlineKeyboardButton((f'{all_appeals[n]}'), callback_data=f'{n}_reg')
                        butt_3 = InlineKeyboardButton((f'{all_appeals[n + 1]}'), callback_data=f'{n + 1}_reg')
                if number_for_afisha == 0:
                    afisha.row(butt_1, butt_2, butt_3)
                    if number_for_afisha == 1:
                        afisha = InlineKeyboardMarkup(resize_keyboard=True)
                    async with state.proxy() as data:
                        if data.get('id_need_1') is None:
                            await bot.edit_message_text( f'üñ±*1/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî\n\n‚ñ´Ô∏è–ò –∫–∞–∫ —Ç—ã, {username}, —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –∫ —Ç–µ–±–µ –æ–±—Ä–∞—â–∞–ª–∏—Å—å?‚ñ´Ô∏è',
                                                 chat_id=callback_query.from_user.id, message_id=callback_query.message.message_id,
                                                reply_markup=afisha, parse_mode=ParseMode.MARKDOWN)

                    @dp.callback_query_handler(lambda c: c.data == f'{n +1}_reg', state=Registor.appeal)
                    async def reag(callback_query: types.CallbackQuery, state: FSMContext):
                        global number_for_afisha
                        await state.update_data(id_need_1=int(callback_query.message.message_id))
                        async with state.proxy() as data:
                            data['appeal'] = all_appeals[n + 1]
                            await asyncio.sleep(0.2)
                            one_reg_button = InlineKeyboardButton((f'‚ûñ'), callback_data=f'‚ûñ_reg')
                            two_reg_button = InlineKeyboardButton((f'{data["appeal"]}'), callback_data=f'‚ûñ_reg')
                            three_reg_kb = InlineKeyboardMarkup(resize_keyboard=True).row(one_reg_button, two_reg_button, one_reg_button)
                            await bot.edit_message_text(text(
                            f'üñ±*1/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–¥–∞, –ø—É—Å—Ç—å –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫–æ –º–Ω–µ –∫–∞–∫ –∫ {data["appeal"]}!___'),
                            chat_id=callback_query.from_user.id, message_id=data["id_need_0"],
                            parse_mode=ParseMode.MARKDOWN, reply_markup= three_reg_kb)
                            await asyncio.sleep(0.5)
                            await callback_query.message.answer(data['appeal'], reply_markup= None)
                            await asyncio.sleep(0.5)
                        await bot.delete_message(callback_query.from_user.id, message_id=callback_query.message.message_id+1)
                        number_for_afisha = 1


                    @dp.callback_query_handler(lambda c: c.data == f'{n}_reg', state = Registor.appeal)
                    async def reag(callback_query: types.CallbackQuery, state: FSMContext):
                        global number_for_afisha
                        await state.update_data(id_need_1=int(callback_query.message.message_id))
                        async with state.proxy() as data:
                            data['appeal'] = all_appeals[n]
                            await asyncio.sleep(0.2)
                            one_reg_button = InlineKeyboardButton((f'‚ûñ'), callback_data=f'‚ûñ_reg')
                            two_reg_button = InlineKeyboardButton((f'{data["appeal"]}'), callback_data=f'‚ûñ_reg')
                            three_reg_kb = InlineKeyboardMarkup(resize_keyboard=True).row(one_reg_button, two_reg_button,
                                                                                          one_reg_button)
                            await bot.edit_message_text(text(
                                f'üñ±*1/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–¥–∞, –ø—É—Å—Ç—å –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫–æ –º–Ω–µ –∫–∞–∫ –∫ {data["appeal"]}!___'),
                                chat_id=callback_query.from_user.id, message_id=data["id_need_0"],
                                parse_mode=ParseMode.MARKDOWN, reply_markup=three_reg_kb)
                            await asyncio.sleep(0.5)
                            await callback_query.message.answer(data['appeal'], reply_markup= None)
                            await asyncio.sleep(0.5)
                        await bot.delete_message(callback_query.from_user.id, message_id=callback_query.message.message_id+1)
                        number_for_afisha = 1


                    @dp.callback_query_handler(lambda c: c.data == f'{n - 1}_reg', state = Registor.appeal)
                    async def reag(callback_query: types.CallbackQuery, state: FSMContext):
                        global number_for_afisha
                        await state.update_data(id_need_1=int(callback_query.message.message_id))
                        async with state.proxy() as data:
                            data['appeal'] = all_appeals[n - 1]
                            await asyncio.sleep(0.2)
                            one_reg_button = InlineKeyboardButton((f'‚ûñ'), callback_data=f'‚ûñ_reg')
                            two_reg_button = InlineKeyboardButton((f'{data["appeal"]}'), callback_data=f'‚ûñ_reg')
                            three_reg_kb = InlineKeyboardMarkup(resize_keyboard=True).row(one_reg_button, two_reg_button,
                                                                                          one_reg_button)
                            await bot.edit_message_text(text(
                                f'üñ±*1/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–¥–∞, –ø—É—Å—Ç—å –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫–æ –º–Ω–µ –∫–∞–∫ –∫ {data["appeal"]}!___'),
                                chat_id=callback_query.from_user.id, message_id=data["id_need_0"],
                                parse_mode=ParseMode.MARKDOWN, reply_markup=three_reg_kb)
                            await asyncio.sleep(0.5)
                            await callback_query.message.answer(data['appeal'], reply_markup= None)
                            await asyncio.sleep(0.5)
                        await bot.delete_message(callback_query.from_user.id, message_id=callback_query.message.message_id+1)
                        number_for_afisha = 1

                    if n == 1 and c == 0:
                        await asyncio.sleep(0.5)
                    else:
                        await asyncio.sleep(1)
                    if number_for_afisha == 1:
                        await Registor.login.set()
                        async with state.proxy() as data:
                            await bot.edit_message_text(text(
                                f'üñ±*1/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–¥–∞, –ø—É—Å—Ç—å –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫–æ –º–Ω–µ –∫–∞–∫ –∫ {data["appeal"]}!___'),
                                chat_id=callback_query.from_user.id, message_id=data["id_need_0"],
                                parse_mode=ParseMode.MARKDOWN)
                            await asyncio.sleep(0.2)
                        message_log = await bot.send_message(callback_query.from_user.id,
                                               text=(f'üñ±*2/5üñ±*\n\n‚ùïÔ∏è|–°–Ω–∞—á–∞–ª–∞, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ª–æ–≥–∏–Ω|‚ùï'),
                                               parse_mode=ParseMode.MARKDOWN)
                        await state.update_data(message_log=int(message_log.message_id))
                        await state.update_data(mes_log=int(message_log.message_id))
                        number_for_afisha = 1
                        break
            except:
                if number_for_afisha == 0:
                    n = -2
                    number = 1
                    c = 1
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        number_for_afisha = 0
        await sto(id_0, callback_query.message.message_id, callback_query.from_user.id, reg_otmena_text_2,
                  regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_4: –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—Ä–∞—â–µ–Ω–∏—è
@dp.message_handler(lambda message: message.text, state=Registor.appeal)
async def appeal_yes_two(message: types.Message, state: FSMContext):
    try:
        username = message.from_user.username
        global number_for_afisha
        await state.update_data(id_need_1=int(message.message_id))
        await Registor.next()
        async with state.proxy() as data:
            if data.get('appeal') is None:
                number_for_afisha = 1
                data['appeal'] = message.text
                await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
                await asyncio.sleep(0.2)
                await bot.edit_message_text(text(
                    f'üñ±*1/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–¥–∞, –ø—É—Å—Ç—å –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫–æ –º–Ω–µ –∫–∞–∫ –∫ {data["appeal"]}!___'),
                    chat_id=message.from_user.id, message_id=data["id_need_0"],
                    parse_mode=ParseMode.MARKDOWN)
        await asyncio.sleep(0.4)

        message_log = await bot.send_message(message.from_user.id,
                                             text=(f'üñ±*2/5üñ±*\n\n‚ùïÔ∏è|–°–Ω–∞—á–∞–ª–∞, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ª–æ–≥–∏–Ω|‚ùï'),
                                             parse_mode=ParseMode.MARKDOWN)
        await state.update_data(message_log=int(message_log.message_id))
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        number_for_afisha = 0
        await sto(id_0, message.message_id, message.from_user.id, reg_otmena_text_2,
                  regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()




# reg_5: –ø—Ä–∏–Ω–∏–º–∞–µ–º –ª–æ–≥–∏–Ω
@dp.message_handler(lambda message: message.text, state=Registor.login)
async def reg_login(message: types.Message, state: FSMContext):
    try:
        global number
        await state.update_data(id_need_2=int(message.message_id))
        username = message.from_user.username
        conn = sqlite3.connect('Day_Plan_db.db', check_same_thread=False)
        cursor = conn.cursor()
        cursor.execute('SELECT COUNT(*) FROM All_Users')
        null = cursor.fetchone()
        async with state.proxy() as data:
            it_id = data['mes_log']
            none_login = data.get("login")
        if null == (0,) and none_login is None:
                async with state.proxy() as data:
                    c = 0
                    number = 0
                    await Registor.next()
                    data['login'] = message.text
                    await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
                    await asyncio.sleep(0.4)

                    await bot.edit_message_text(text(
                        f'üñ±*2/5üñ±*\n\n‚ùïÔ∏è|–°–Ω–∞—á–∞–ª–∞, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ª–æ–≥–∏–Ω|‚ùï\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–º–æ–π –ª–æ–≥–∏–Ω - {data["login"]}!___'),
                        chat_id=message.from_user.id, message_id=it_id,
                        parse_mode=ParseMode.MARKDOWN)
                    await asyncio.sleep(0.2)
                    mes_reg = await bot.send_message(message.from_user.id,
                                           text=(f'üñ±*3/5üñ±*\n\n‚ùïÔ∏è|–ê —Ç–µ–ø–µ—Ä—å, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ø–∞—Ä–æ–ª—å|‚ùï'),
                                           parse_mode=ParseMode.MARKDOWN)
                await state.update_data(mes_reg=int(mes_reg.message_id))
                await state.update_data(message_reg=int(mes_reg.message_id))

        elif null != (0,) and none_login is None:
            cursor.execute("SELECT Login FROM All_Users WHERE Login = ?", (message.text,))
            path = cursor.fetchone()
            if path is None:
                async with state.proxy() as data:
                    await Registor.next()
                    c = 0
                    number = 0
                    data['login'] = message.text
                    await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
                    await asyncio.sleep(0.4)
                    await bot.edit_message_text(text(
                        f'üñ±*2/5üñ±*\n\n‚ùïÔ∏è|–°–Ω–∞—á–∞–ª–∞, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ª–æ–≥–∏–Ω|‚ùï\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–º–æ–π –ª–æ–≥–∏–Ω - {data["login"]}!___'),
                        chat_id=message.from_user.id, message_id=it_id,
                        parse_mode=ParseMode.MARKDOWN)
                    await asyncio.sleep(0.2)
                    mes_reg = await bot.send_message(message.from_user.id,
                                                     text=(
                                                         f'üñ±*3/5üñ±*\n\n‚ùïÔ∏è|–ê —Ç–µ–ø–µ—Ä—å, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ø–∞—Ä–æ–ª—å|‚ùï'),
                                                     parse_mode=ParseMode.MARKDOWN)
                await state.update_data(message_reg=int(mes_reg.message_id))
                number = 0
            else:
                number = number + 1
                await state.update_data(message_log=int(message.message_id))
                await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
                await bot.edit_message_text(text((
                    f'üñ±*2/5*üñ±\n\n‚ùïÔ∏è|–°–Ω–∞—á–∞–ª–∞, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ª–æ–≥–∏–Ω|‚ùï\n\n‚ñ´Ô∏è–õ–æ–≥–∏–Ω "{message.text}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!‚ñ´Ô∏è\n‚ùïÔ∏è|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                    bold(f' {str(number)}') + (' –∏–∑ 5|‚ùï')), chat_id=message.from_user.id,
                    message_id=it_id, parse_mode=ParseMode.MARKDOWN)
                if number == 5:
                    number = 0
                    global number_for_afisha
                    async with state.proxy() as data:
                        vam = data['id_need']
                    await sto(vam, message.message_id, message.from_user.id, reg_otmena_text_2, regORaut_text,
                              regORaut_board)
                    await state.finish()
                    await Begin.regORaut.set()
                    number_for_afisha = 0
        else:
            number = 0
            if none_login is None:
                async with state.proxy() as data:
                    vam = data['id_need']
                await sto(vam, message.message_id, message.from_user.id, reg_otmena_text_2, regORaut_text, regORaut_board)
                await state.finish()
                await Begin.regORaut.set()
                number_for_afisha = 0

        conn.commit()
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        number_for_afisha = 0
        await sto(id_0, message.message_id, message.from_user.id, reg_otmena_text_2,
                  regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_6: –ø—Ä–∏–Ω–∏–º–∞–µ–º –ø–∞—Ä–æ–ª—å
@dp.message_handler(lambda message: message.text, state=Registor.password)
async def reg_pass(message: types.Message, state: FSMContext):
    try:
        global number
        global help_pass_list
        username = message.from_user.username
        async with state.proxy() as data:
            none_pass = data.get("password")
            it_id = data['message_reg']

        if none_pass is None:
                if len(message.text) >= 6 and str(data["login"]) != str(message.text):
                    async with state.proxy() as data:
                        number = 0
                        data['password'] = message.text
                        await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
                        await asyncio.sleep(0.4)
                        await bot.edit_message_text(text(
                            f'üñ±*3/5üñ±*\n\n‚ùïÔ∏è|–ê —Ç–µ–ø–µ—Ä—å, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ø–∞—Ä–æ–ª—å|‚ùï\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–º–æ–π –ø–∞—Ä–æ–ª—å - {len(data["password"]) * "*"}!___'),
                                                    chat_id=message.from_user.id, message_id=it_id,
                                                    parse_mode=ParseMode.MARKDOWN)
                        s_c = InlineKeyboardButton((emojize("‚úîÔ∏è–°–ï–ö–†–ï–¢–ù–´–ô –ö–û–î –°–û–•–†–ê–ù–Å–ù‚úîÔ∏è")), callback_data='s_code')
                        kb_code = InlineKeyboardMarkup(resize_keyboard=True).add(s_c)
                        await Registor.next()
                        await asyncio.sleep(0.2)
                        secret_code = create_secret_code()
                        await bot.send_message(message.from_user.id,
                                               text=text((
                                                             f'üñ±*4/5üñ±*\n\n‚ùïÔ∏è|SECRET CODE –ø–æ—Ç–µ—Ä—É–±–µ—Ç—Å—è –≤–∞–º, {username}, –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –≤ —Å–ª—É—á–∞–µ –µ–≥–æ –ø–æ—Ç–µ—Ä–∏|‚ùï\n\n‚ñ´Ô∏èÔ∏è–í–∞—à SECRET CODE: '),
                                                         code(f'{secret_code}'),
                                                         "‚ñ´\n\nüìå–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è –Ω–∞ –∫–Ω–æ–ø–∫—É SECRET CODE –±—É–¥–µ—Ç —Å–∫—Ä—ã—Ç"),
                                               parse_mode=ParseMode.MARKDOWN, reply_markup=kb_code)
                        data['s_code'] = secret_code
                else:
                    number = number + 1
                    await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
                    if len(message.text) < 6 and str(data["login"]) == str(message.text):
                        await state.update_data(mes_reg=int(message.message_id))
                        await bot.edit_message_text(text((
                            f'üñ±*3/5*üñ±\n\n‚ùïÔ∏è|–ê —Ç–µ–ø–µ—Ä—å, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ø–∞—Ä–æ–ª—å|‚ùï\n\n‚ñ´Ô∏è–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ –ø—è—Ç–∏ —Å–∏–º–≤–æ–ª–æ–≤ –∏ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –ª–æ–≥–∏–Ω–∞‚ñ´Ô∏è\n‚ùïÔ∏è|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                            bold(f' {str(number)}') + (' –∏–∑ 5|‚ùï')), chat_id=message.from_user.id,
                            message_id=it_id, parse_mode=ParseMode.MARKDOWN)

                    elif len(message.text) < 6:
                        await state.update_data(mes_reg=int(message.message_id))
                        await bot.edit_message_text(text((
                            f'üñ±*3/5*üñ±\n\n‚ùïÔ∏è|–ê —Ç–µ–ø–µ—Ä—å, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ø–∞—Ä–æ–ª—å|‚ùï\n\n‚ñ´Ô∏è–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ –ø—è—Ç–∏ —Å–∏–º–≤–æ–ª–æ–≤‚ñ´Ô∏è\n‚ùïÔ∏è|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                            bold(f' {str(number)}') + (' –∏–∑ 5|‚ùï')), chat_id=message.from_user.id,
                            message_id=it_id, parse_mode=ParseMode.MARKDOWN)

                    elif str(data["login"]) == str(message.text):
                        await state.update_data(mes_reg=int(message.message_id))
                        await bot.edit_message_text(text((
                            f'üñ±*3/5*üñ±\n\n‚ùïÔ∏è|–ê —Ç–µ–ø–µ—Ä—å, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ø–∞—Ä–æ–ª—å|‚ùï\n\n‚ñ´Ô∏è–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –ª–æ–≥–∏–Ω–∞‚ñ´Ô∏è\n‚ùïÔ∏è|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                            bold(f' {str(number)}') + (' –∏–∑ 5|‚ùï')), chat_id=message.from_user.id,
                            message_id=it_id, parse_mode=ParseMode.MARKDOWN)

                    if number == 5:
                        number = 0
                        global number_for_afisha
                        async with state.proxy() as data:
                            vam = data['id_need']
                        await sto(vam, message.message_id, message.from_user.id, reg_otmena_text_2, regORaut_text,
                                  regORaut_board)
                        await state.finish()
                        await Begin.regORaut.set()
                        number_for_afisha = 0

        else:
            if none_pass is None:
                number = 0
                async with state.proxy() as data:
                    vam = data['id_need']
                await sto(vam, message.message_id, message.from_user.id, reg_otmena_text_2, regORaut_text,
                          regORaut_board)
                await state.finish()
                await Begin.regORaut.set()
                number_for_afisha = 0
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        number_for_afisha = 0
        await sto(id_0, message.message_id, message.from_user.id, reg_otmena_text_2,
                  regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_7: —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥
@dp.callback_query_handler(lambda c: c.data == 's_code', state=Registor.s_code)
async def s_code(callback_query: types.CallbackQuery, state: FSMContext):
    try:
        global number
        username = callback_query.from_user.username
        await asyncio.sleep(0.5)
        await callback_query.message.edit_text(
            f'üñ±*4/5üñ±*\n\n‚ùïÔ∏è|SECRET CODE –ø–æ—Ç–µ—Ä—É–±–µ—Ç—Å—è –≤–∞–º, {username}, –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ø–∞—Ä–æ–ª—è –≤ —Å–ª—É—á–∞–µ –µ–≥–æ –ø–æ—Ç–µ—Ä–∏|‚ùï\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–º–æ–π SECRET CODE - –∑–∞–ø–∏—Å–∞–Ω!___Ô∏è',
            parse_mode=ParseMode.MARKDOWN)
        await asyncio.sleep(0.5)
        await state.update_data(null_message=int(callback_query.message.message_id))
        async with state.proxy() as data:
            if data.get("appeal") is not None:
                await bot.send_message(callback_query.from_user.id,
                                       text=text(
                                           f'üñ±<b>5/5üñ±</b>\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\nÔ∏è<b>Ô∏èÔ∏è‚ñ´–í–∞—à–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ:</b> <code>{data["appeal"]}</code>‚ñ´Ô∏è\n'
                                           f'‚ñ´<b>–í–∞—à –ª–æ–≥–∏–Ω:</b> <code>{data["login"]}</code>‚ñ´Ô∏è\n'
                                           f'‚ñ´<b>–í–∞—à –ø–∞—Ä–æ–ª—å:</b> <code>{data["password"]}</code>‚ñ´Ô∏è\n\n'
                                           f'üìå–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã'),
                                       parse_mode='HTML', reply_markup=kb_control)
                number = 0
            else:
                await bot.send_message(callback_query.from_user.id,
                                       text=text(
                                           f'üñ±<b>5/5üñ±</b>\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n'
                                           f'‚ñ´<b>–í–∞—à –ª–æ–≥–∏–Ω:</b> <code>{data["login"]}</code>‚ñ´Ô∏è\n'
                                           f'‚ñ´<b>–í–∞—à –ø–∞—Ä–æ–ª—å:</b> <code>{data["password"]}</code>‚ñ´Ô∏è\n\n'
                                           f'üìå–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã'),
                                       parse_mode='HTML', reply_markup=kb_control)
                number = 0
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        global number_for_afisha
        number_for_afisha = 0
        await sto(id_0, callback_query.message.message_id, callback_query.from_user.id, reg_otmena_text_2,
                  regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_8: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —É—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
@dp.callback_query_handler(lambda c: c.data == 'control_inform_yes', state=Registor.s_code)
async def all_reg_ok(callback_query: types.CallbackQuery, state: FSMContext):
        async with state.proxy() as data:
            ama = data['null_message']
        username = callback_query.from_user.username
        await bot.edit_message_text((f'üñ±*5/5*üñ±\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–¥–∞, –≤—Å—ë —Ç–∞–∫, –∫–∞–∫ –∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å!___'),
                                    chat_id=callback_query.from_user.id, message_id=ama+1, parse_mode=ParseMode.MARKDOWN)
        await bot.send_message(callback_query.from_user.id, "üèµüèµüèµ")
        await bot.send_message(callback_query.from_user.id, "‚ö´Ô∏è‚ö´Ô∏è‚ö´Ô∏è")
        await bot.send_message(callback_query.from_user.id, "üí•üí•üí•")
        await bot.send_message(callback_query.from_user.id, "‚ö´Ô∏è‚ö´Ô∏è‚ö´Ô∏è")
        more = await bot.send_message(callback_query.from_user.id, "üèµüèµüèµ")

        raz = (more.message_id) - (ama + 1) - 5
        await asyncio.sleep(0.3)
        await bot.edit_message_text("üî•üî•üî•", chat_id=callback_query.from_user.id,
                                    message_id=ama+2+raz)
        await bot.edit_message_text("üî•üî•üî•", chat_id=callback_query.from_user.id,
                                    message_id=ama+6+raz)
        await asyncio.sleep(0.2)
        await bot.edit_message_text("üî¥üî¥üî¥", chat_id=callback_query.from_user.id,
                                    message_id=ama+3+raz)
        await bot.edit_message_text("üî¥üî¥üî¥", chat_id=callback_query.from_user.id,
                                    message_id=ama+5+raz)
        await bot.edit_message_text("üí•", chat_id=callback_query.from_user.id,
                                    message_id=ama+4+raz)
        await asyncio.sleep(0.2)
        await bot.delete_message(chat_id=callback_query.from_user.id,
                                 message_id=ama+2+raz)
        await bot.delete_message(chat_id=callback_query.from_user.id,
                                 message_id=ama+6+raz)
        await bot.edit_message_text("üî•", chat_id=callback_query.from_user.id,
                                    message_id=ama + 4+raz)
        await asyncio.sleep(0.2)
        await bot.delete_message(chat_id=callback_query.from_user.id,
                                 message_id=ama + 3+raz)
        await bot.delete_message(chat_id=callback_query.from_user.id,
                                 message_id=ama + 5+raz)
        await asyncio.sleep(0.5)
        await bot.edit_message_text("üéâ", chat_id=callback_query.from_user.id,
                                    message_id=ama + 4+raz)
        await asyncio.sleep(2)
        await bot.delete_message(chat_id=callback_query.from_user.id,
                                 message_id=ama + 4+raz)
        await bot.answer_callback_query(callback_query.id, "‚úÖ–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê‚ùå", show_alert=True)
        await bot.send_message(callback_query.from_user.id, text(emojize("üîí‚ûñ*–† –ï –ì –ò –° –¢ –† –ê –¶ –ò –Ø*‚ûñüîí")),
                               parse_mode=ParseMode.MARKDOWN, reply_markup=ReplyKeyboardRemove())
        conn = sqlite3.connect(f'Day_Plan_db.db', check_same_thread=False)
        cursor = conn.cursor()
        n = 0
        number_full = 0
        bot_id = ""
        while n != 5:
            number = random.randint(0,10)
            number_full = number_full + number
            bot_id = bot_id + str(number)
            n += 1
        else:
            bot_id = bot_id + str(number_full)
        day_reg = datetime.datetime.today()
        async with state.proxy() as data:
            if data.get('appeal') is not None:
                cursor.execute('INSERT INTO All_Users (Appeal, Login, Password, Secret_Code, Bot_ID, Date_Reg) VALUES (?, ?, ?, ?, ?, ?)', (data['appeal'], data['login'], data['password'], data['s_code'], int(bot_id), day_reg,))
            else:
                cursor.execute(
                    'INSERT INTO All_Users (Login, Password, Secret_Code, Bot_ID, Date_Reg) VALUES (?, ?, ?, ?, ?)',
                    (data['login'], data['password'], data['s_code'], int(bot_id), day_reg,))
        os.mkdir(f"Users_BOT/{data['login']}_log")
        conn_0 = sqlite3.connect(f'Users_BOT/{data["login"]}_log/{data["login"]}_dbS.db', check_same_thread=False)
        cursor_0 = conn_0.cursor()
        cursor_0.execute(f'''CREATE TABLE 
                            basis ([DATE] DATETIME,
                             [WEEK DAY] STRING,
                              [ACTIVITY DAYS] STRING,
                               [FULL/NOT FULL] INTEGER,
                                [Time End of Day Plan] DATETIME);''')
        cursor_0.execute(f'''CREATE TABLE 
                            classification_of_elements ([Hierarchy] STRING, 
                            [Time values] STRING, 
                            [Mode] STRING, 
                            [Type] STRING, 
                            [View] STRING, 
                            [Name in DAY PLAN] STRING, 
                            [Description in DAY PLAN] STRING, 
                            [Description as element] STRING);''')
        await state.finish()
        conn.commit()

        help_reg_list = []
        list_with_date_in_words(day_reg, help_reg_list)
        await asyncio.sleep(1.2)
        await bot.send_message(callback_query.from_user.id, text(emojize(f"üóì*–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã*üóì\n"
                                                                         f":{help_reg_list[0]}::{help_reg_list[1]}:‚ñ™"
                                                                         f"Ô∏è:{help_reg_list[2]}::{help_reg_list[3]}:‚ñ™"
                                                                         f"Ô∏è:{help_reg_list[4]}::{help_reg_list[5]}::{help_reg_list[6]}::{help_reg_list[7]}:"
                                                                         f"\n\n *–°–ø–∞—Å–∏–±–æ, —á—Ç–æ –≤—ã —Å –Ω–∞–º–∏!*")), parse_mode=ParseMode.MARKDOWN)
        await Begin.regORaut.set()
        await asyncio.sleep(1)
        await bot.send_message(callback_query.from_user.id, regORaut_text, parse_mode=ParseMode.MARKDOWN, reply_markup=regORaut_board)



# reg_9: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ù–ï —É—Å—Ç—Ä–∞–∏–≤–∞—é—Ç –µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
@dp.callback_query_handler(lambda c: c.data == 'control_inform_no', state=Registor.s_code)
async def all_reg_no_ok(callback_query: types.CallbackQuery, state: FSMContext):
    await state.update_data(id_need_3=int(callback_query.message.message_id))
    username = callback_query.from_user.username
    await bot.edit_message_text((
                                    f'üñ±*5/5*üñ±\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n‚ñ´Ô∏è–ò —á—Ç–æ –∂–µ –≤–∞—Å –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç?‚ñ´Ô∏è'),
                                chat_id=callback_query.from_user.id, message_id=callback_query.message.message_id, reply_markup= reforming_kb,
                                parse_mode=ParseMode.MARKDOWN)


# reg_10: –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞–∑–∞–¥ –≤ –º–µ–Ω—é, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ç–æ–≥–æ –∑–∞—Ö–æ—Ç–µ–ª
@dp.callback_query_handler(lambda c: c.data == 'come_ref_menu', state=Registor.s_code)
async def come_ref_menu(callback_query: types.CallbackQuery, state: FSMContext):
    global number
    username = callback_query.from_user.username
    async with state.proxy() as data:
        if data.get("appeal") is not None:
            await callback_query.message.edit_text(
                                   text=text(
                                       f'üñ±<b>5/5üñ±</b>\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n'
                                       f'‚ñ´Ô∏è<b>Ô∏èÔ∏è–í–∞—à–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ:</b> <code>{data["appeal"]}</code>‚ñ´Ô∏è\n'
                                       f'‚ñ´<b>–í–∞—à –ª–æ–≥–∏–Ω:</b> <code>{data["login"]}</code>‚ñ´Ô∏è\n'
                                       f'‚ñ´<b>–í–∞—à –ø–∞—Ä–æ–ª—å:</b> <code>{data["password"]}</code>‚ñ´Ô∏è\n\n'
                                       f'üìå–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã'),
                                   parse_mode='HTML', reply_markup=kb_control)
            number = 0
        else:
            await callback_query.message.edit_text(
                                   text=text(
                                       f'üñ±<b>5/5üñ±</b>\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n'
                                       f'‚ñ´<b>–í–∞—à –ª–æ–≥–∏–Ω:</b> <code>{data["login"]}</code>‚ñ´Ô∏è\n'
                                       f'‚ñ´<b>–í–∞—à –ø–∞—Ä–æ–ª—å:</b> <code>{data["password"]}</code>‚ñ´Ô∏è\n\n'
                                       f'üìå–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã'),
                                   parse_mode='HTML', reply_markup=kb_control)
            number = 0


# reg_11: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç –ø—Ä–æ–π—Ç–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –∑–∞–Ω–æ–≤–æ
@dp.callback_query_handler(lambda c: c.data == 'reforming_reg', state=Registor.s_code)
async def ref_reg(callback_query: types.CallbackQuery, state: FSMContext):
    try:
        global number_for_afisha
        async with state.proxy() as data:
            vam = data['id_need']
        await sto(vam, message.message_id, message.from_user.id, reg_otmena_text_2, regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()
        number_for_afisha = 0
        await bot.send_message(callback_query.from_user.id, text(emojize("üîí‚ûñ*–† –ï –ì –ò –° –¢ –† –ê –¶ –ò –Ø*‚ûñüîí")),
                                   parse_mode=ParseMode.MARKDOWN, reply_markup=rg_stop_kb)

        await asyncio.sleep(0.2)
        await bot.send_message(callback_query.from_user.id,
                                   text=("üñ±*1/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî"),
                                   reply_markup=appeal_board, parse_mode=ParseMode.MARKDOWN)
        await asyncio.sleep(0.3)
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        number_for_afisha = 0
        await sto(id_0, callback_query.message.message_id, callback_query.from_user.id, reg_otmena_text_3,
                  regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_12: –ø—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞—â–µ–Ω–∏–µ–º
@dp.callback_query_handler(lambda c: c.data == 'reforming_appeal', state=Registor.s_code)
async def ref_appeal(callback_query: types.CallbackQuery, state: FSMContext):
    username = callback_query.from_user.username
    async with state.proxy() as data:
        await bot.edit_message_text((
            f'üñ±*5/5*üñ±\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n‚ñ´Ô∏è–ò —á—Ç–æ –∂–µ –≤–∞—Å –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç?‚ñ´Ô∏è'),
            chat_id=callback_query.from_user.id, message_id=data['id_need_3'], parse_mode=ParseMode.MARKDOWN)
    appeal_boardX = InlineKeyboardMarkup().row(InlineKeyboardButton(("‚úîÔ∏è–î–ê‚úîÔ∏è"), callback_data="ref_appeal_yes"),
                                              InlineKeyboardButton(("‚úñÔ∏è–ù–ï–¢‚úñÔ∏è"), callback_data="ref_appeal_no")).add(
                                              InlineKeyboardButton((emojize("Ô∏èÔ∏è–ù–ê–ó–ê–î‚Ü©Ô∏è")), callback_data='come_adding_menu'))
    await bot.send_message(callback_query.from_user.id,
                           text=("üñ±*X/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî"),
                           reply_markup=appeal_boardX, parse_mode=ParseMode.MARKDOWN)


# reg_13: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–µ –Ω—É–∂–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ, –∏ –æ–Ω —ç—Ç–æ —Ö–æ—á–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å
@dp.callback_query_handler(lambda c: c.data == 'ref_appeal_no', state=Registor.s_code)
async def ref_appeal_no(callback_query: types.CallbackQuery, state: FSMContext):
    try:
        await callback_query.message.edit_text(
            text(('üñ±*X/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:*'),
                 (" ___–Ω–µ—Ç, –Ω–µ –Ω—É–∂–Ω–æ!___")), parse_mode=ParseMode.MARKDOWN)
        async with state.proxy() as data:
            data['appeal'] = None
            id_0 = data['id_need_3']
        await delete_messages_before_Nmessage(id_0, callback_query.message.message_id, callback_query.from_user.id)
        username = callback_query.from_user.username
        await bot.edit_message_text(text=text(
                                           f'üñ±<b>5/5üñ±</b>\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n'
                                           f'‚ñ´<b>–í–∞—à –ª–æ–≥–∏–Ω:</b> <code>{data["login"]}</code>‚ñ´Ô∏è\n'
                                           f'‚ñ´<b>–í–∞—à –ø–∞—Ä–æ–ª—å:</b> <code>{data["password"]}</code>‚ñ´Ô∏è\n\n'
                                           f'üìå–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã'),
                                        chat_id=callback_query.from_user.id, message_id=id_0, parse_mode='HTML', reply_markup= kb_control)
        await asyncio.sleep(0.5)
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        global number_for_afisha
        number_for_afisha = 0
        await sto(id_0, callback_query.message.message_id, callback_query.from_user.id, reg_otmena_text_2,
                  regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_14: –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω—É–∂–Ω–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ, –∏ –æ–Ω —ç—Ç–æ —Ö–æ—á–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å
@dp.callback_query_handler(lambda c: c.data == 'ref_appeal_yes', state=Registor.s_code)
async def ref_appeal_yes(callback_query: types.CallbackQuery, state: FSMContext):
    try:
        await HelpC.appeal.set()
        username = callback_query.from_user.username
        await asyncio.sleep(0.5)
        await callback_query.message.edit_text(
            f'üñ±*X/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî\n\n‚ñ´Ô∏è–ò –∫–∞–∫ —Ç—ã, {username}, —Ö–æ—á–µ—à—å, —á—Ç–æ–±—ã –∫ —Ç–µ–±–µ –æ–±—Ä–∞—â–∞–ª–∏—Å—å?‚ñ´Ô∏è',
            parse_mode=ParseMode.MARKDOWN)
        await state.update_data(id_need_0X=int(callback_query.message.message_id))
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        global number_for_afisha
        number_for_afisha = 0
        await sto(id_0, callback_query.message.message_id, callback_query.from_user.id, reg_otmena_text_2,
                  regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_15: –≤–Ω–æ—Å–∏–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –æ–±—Ä–∞—â–µ–Ω–∏—è –≤ —Å–∏—Å—Ç–µ–º—É
@dp.message_handler(lambda message: message.text, state=HelpC.appeal)
async def appeal_ref_yes(message: types.Message, state: FSMContext):
    try:
        async with state.proxy() as data:
            data['appeal'] = message.text
            await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
            await bot.edit_message_text(text(
                f'üñ±*X/5üñ±*\n\n‚ùîÔ∏è|–ù—É–∂–Ω–æ –ª–∏ DAY PLAN –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –≤–∞–º –ø–æ-–æ—Å–æ–±–æ–º—É|‚ùî\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–î–∞, –ø—É—Å—Ç—å –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫–æ –º–Ω–µ –∫–∞–∫ –∫ {message.text}!___'),
                chat_id=message.from_user.id, message_id=data["id_need_0X"],
                parse_mode=ParseMode.MARKDOWN)
            id_0 = data['id_need_3']
            await delete_messages_before_Nmessage(id_0, message.message_id, message.from_user.id)
            await Registor.s_code.set()
            username = message.from_user.username
            await bot.edit_message_text(text=text(
                                                     f'üñ±<b>5/5üñ±</b>\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n'
                                                     f'<b>Ô∏èÔ∏è‚ñ´–í–∞—à–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ:</b> <code>{data["appeal"]}</code>‚ñ´Ô∏è\n'
                                                     f'‚ñ´<b>–í–∞—à –ª–æ–≥–∏–Ω:</b> <code>{data["login"]}</code>‚ñ´Ô∏è\n'
                                                     f'‚ñ´<b>–í–∞—à –ø–∞—Ä–æ–ª—å:</b> <code>{data["password"]}</code>‚ñ´Ô∏è\n\n'
                                                     f'üìå–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã'),
                chat_id=message.from_user.id, message_id=id_0, parse_mode='HTML', reply_markup=kb_control)
        await asyncio.sleep(0.2)
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        global number_for_afisha
        number_for_afisha = 0
        await sto(id_0, message.message_id, message.from_user.id, reg_otmena_text_2, regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_16: –ø—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–≥–∏–Ω–æ–º
@dp.callback_query_handler(lambda c: c.data == 'reforming_login', state=[Registor.s_code, HelpC.password])
async def ref_login(callback_query: types.CallbackQuery, state: FSMContext):
    try:
        global pass_log_number
        if pass_log_number != 0:
            await bot.delete_message(chat_id=callback_query.from_user.id, message_id=callback_query.message.message_id)
            pass_log_number = 0
        username = callback_query.from_user.username
        async with state.proxy() as data:
            try:
                await bot.edit_message_text((
                    f'üñ±*5/5*üñ±\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n‚ñ´Ô∏è–ò —á—Ç–æ –∂–µ –≤–∞—Å –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç?‚ñ´Ô∏è'),
                    chat_id=callback_query.from_user.id, message_id=data['id_need_3'], parse_mode=ParseMode.MARKDOWN)
            except:
                pass
        login_board = InlineKeyboardMarkup().add(InlineKeyboardButton((emojize("Ô∏èÔ∏è–ù–ê–ó–ê–î‚Ü©Ô∏è")), callback_data='come_adding_menu'))
        await bot.send_message(
            callback_query.from_user.id, text=(f'üñ±*Y/5üñ±*\n\n‚ùïÔ∏è|{username}, –æ–±–Ω–æ–≤–∏—Ç–µ —Å–≤–æ–π –ª–æ–≥–∏–Ω|‚ùï'), parse_mode=ParseMode.MARKDOWN, reply_markup= login_board)
        await state.update_data(mes_log_help_two=int(callback_query.message.message_id))
        await HelpC.login.set()
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        global number_for_afisha
        number_for_afisha = 0
        await sto(id_0, callback_query.message.message_id, callback_query.from_user.id, reg_otmena_text_2, regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_17: –ø—Ä–∏–Ω–∏–º–∞–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –ª–æ–≥–∏–Ω
@dp.message_handler(lambda message: message.text, state=HelpC.login)
async def ref_login_two(message: types.Message, state: FSMContext):
    try:
        global number
        global beta_number
        global help_pass_list
        global pass_log_number
        username = message.from_user.username
        if beta_number == 0:
            await state.update_data(id_need_1X=int(message.message_id - 1))
            async with state.proxy() as data:
                new_id = data['mes_log_help_two'] + 1
                ced = message.message_id - (new_id+1)
                new_id = new_id + ced
                help_pass_list.append(new_id)
        help_pass_list[0] = help_pass_list[0] + 1
        conn = sqlite3.connect('Day_Plan_db.db', check_same_thread=False)
        cursor = conn.cursor()
        cursor.execute("SELECT Login FROM All_Users WHERE Login = ?", (message.text,))
        path = cursor.fetchone()
        async with state.proxy() as data:
            passe = data.get("password")
        if message.text != passe and path is None and number != 6:
            async with state.proxy() as data:
                number = 0
                beta_number = 0
                help_pass_list = []
                data['login'] = message.text
                await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
                await bot.edit_message_text(
                    f'üñ±*Y/5üñ±*\n\n‚ùïÔ∏è|{username}, –æ–±–Ω–æ–≤–∏—Ç–µ —Å–≤–æ–π –ª–æ–≥–∏–Ω|‚ùï\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–º–æ–π –ª–æ–≥–∏–Ω - {data["login"]}!___',
                    chat_id=message.from_user.id, message_id=data['id_need_1X'], parse_mode=ParseMode.MARKDOWN)
                id_0 = data['id_need_3']
                await delete_messages_before_Nmessage(id_0, message.message_id, message.from_user.id)
                await Registor.s_code.set()
                username = message.from_user.username
                if data.get("appeal") is not None:
                    await bot.edit_message_text(
                        text=text(
                            f'üñ±<b>5/5üñ±</b>\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n'
                            f'‚ñ´<b>Ô∏èÔ∏è–í–∞—à–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ:</b> <code>{data["appeal"]}</code>‚ñ´Ô∏è\n'
                            f'‚ñ´<b>–í–∞—à –ª–æ–≥–∏–Ω:</b> <code>{data["login"]}</code>‚ñ´Ô∏è\n'
                            f'‚ñ´<b>–í–∞—à –ø–∞—Ä–æ–ª—å:</b> <code>{data["password"]}</code>‚ñ´Ô∏è\n\n'
                            f'üìå–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã'),
                        chat_id=message.from_user.id, message_id=id_0,
                        parse_mode='HTML', reply_markup=kb_control)
                else:
                    await bot.edit_message_text(
                        text=text(
                            f'üñ±<b>5/5üñ±</b>\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n'
                            f'‚ñ´<b>–í–∞—à –ª–æ–≥–∏–Ω:</b> <code>{data["login"]}</code>‚ñ´Ô∏è\n'
                            f'‚ñ´<b>–í–∞—à –ø–∞—Ä–æ–ª—å:</b> <code>{data["password"]}</code>‚ñ´Ô∏è\n\n'
                            f'üìå–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã'),
                        chat_id=message.from_user.id, message_id=id_0,
                        parse_mode='HTML', reply_markup=kb_control)

        elif message.text == passe and number !=6 and path is None:
            number = number + 1
            beta_number = 1
            await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
            reforming_pass = InlineKeyboardButton((emojize("üîôÔ∏è–ò–ó–ú–ï–ù–ò–¢–¨ –ü–ê–†–û–õ–¨Ô∏è")), callback_data='reforming_pass')
            reforming_kb = InlineKeyboardMarkup(resize_keyboard=True).row(reforming_pass)
            await bot.edit_message_text(text((
                f'üñ±*Y/5*üñ±\n\n‚ùïÔ∏è|{username}, –æ–±–Ω–æ–≤–∏—Ç–µ —Å–≤–æ–π –ª–æ–≥–∏–Ω|‚ùï\n\n‚ñ´Ô∏è–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ª–æ–≥–∏–Ω –¥–æ–ª–∂–µ–Ω –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –ø–∞—Ä–æ–ª—è‚ñ´Ô∏è\n‚ùïÔ∏è|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                bold(f' {str(number)}') + (' –∏–∑ 5|‚ùï')), chat_id=message.from_user.id,
                message_id=data["id_need_1X"], parse_mode=ParseMode.MARKDOWN, reply_markup=reforming_kb)
            pass_log_number = 1
        elif path is not None and number != 6 and message.text != passe:
            beta_number = 1
            number = number + 1
            await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
            await bot.edit_message_text(text((
                f'üñ±*Y/5*üñ±\n\n‚ùïÔ∏è|{username}, –æ–±–Ω–æ–≤–∏—Ç–µ —Å–≤–æ–π –ª–æ–≥–∏–Ω|‚ùï\n\n‚ñ´Ô∏èÔ∏è–õ–æ–≥–∏–Ω "{message.text}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!‚ñ´Ô∏è\n‚ùïÔ∏è|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                bold(f' {str(number)}') + (' –∏–∑ 5|‚ùï')), chat_id=message.from_user.id,
                message_id=data["id_need_1X"], parse_mode=ParseMode.MARKDOWN)
        elif message.text == passe and path is not None and number !=6:
            number = number + 1
            beta_number = 1
            await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
            await bot.edit_message_text(text((
                f'üñ±*Y/5*üñ±\n\n‚ùïÔ∏è|{username}, –æ–±–Ω–æ–≤–∏—Ç–µ —Å–≤–æ–π –ª–æ–≥–∏–Ω|‚ùï\n\n‚ñ´Ô∏èÔ∏è–õ–æ–≥–∏–Ω "{message.text}" —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –¥–æ–ª–∂–µ–Ω –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –ø–∞—Ä–æ–ª—è!‚ñ´Ô∏è\n‚ùïÔ∏è|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                bold(f' {str(number)}') + (' –∏–∑ 5|‚ùï')), chat_id=message.from_user.id,
                message_id=data["id_need_1X"], parse_mode=ParseMode.MARKDOWN)
        if number == 5:
            number = 0
            global number_for_afisha
            async with state.proxy() as data:
                vam = data['id_need']
            await sto(vam, message.message_id, message.from_user.id, reg_otmena_text_2, regORaut_text,
                      regORaut_board)
            await state.finish()
            await Begin.regORaut.set()
            number_for_afisha = 0
        conn.commit()
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        number_for_afisha = 0
        await sto(id_0, message.message_id, message.from_user.id, reg_otmena_text_2, regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_18: –ø—Ä–æ–±–ª–µ–º—ã —Å –ø–∞—Ä–æ–ª–µ–º
@dp.callback_query_handler(lambda c: c.data == 'reforming_pass', state= [Registor.s_code, HelpC.login])
async def ref_pass(callback_query: types.CallbackQuery, state: FSMContext):
    try:
        global pass_log_number
        if pass_log_number != 0:
            await bot.delete_message(chat_id=callback_query.from_user.id, message_id=callback_query.message.message_id)
            pass_log_number = 0
        username = callback_query.from_user.username
        async with state.proxy() as data:
            global number
            number = 0
            try:
                await bot.edit_message_text((
                f'üñ±*5/5*üñ±\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n‚ñ´Ô∏è–ò —á—Ç–æ –∂–µ –≤–∞—Å –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç?‚ñ´Ô∏è'),
                chat_id=callback_query.from_user.id, message_id=data['id_need_3'], parse_mode=ParseMode.MARKDOWN)
            except:
                pass
        await HelpC.password.set()
        password_board = InlineKeyboardMarkup().add(
            InlineKeyboardButton((emojize("Ô∏èÔ∏è–ù–ê–ó–ê–î‚Ü©Ô∏è")), callback_data='come_adding_menu'))
        await bot.send_message(callback_query.from_user.id, text=(f'üñ±*Z/5üñ±*\n\n‚ùïÔ∏è|{username}, –æ–±–Ω–æ–≤–∏—Ç–µ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å|‚ùï'), parse_mode=ParseMode.MARKDOWN, reply_markup= password_board)
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        global number_for_afisha
        number_for_afisha = 0
        await sto(id_0, callback_query.message.message_id, callback_query.from_user.id, reg_otmena_text_2, regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_19: –ø—Ä–∏–Ω–∏–º–∞–µ–º –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
@dp.message_handler(lambda message: message.text, state=HelpC.password)
async def ref_pass_two(message: types.Message, state: FSMContext):
    try:
        global number
        global pass_log_number
        username = message.from_user.username
        if number == 0:
            await state.update_data(id_need_2X=int(message.message_id-1))
        async with state.proxy() as data:
            if len(message.text) >= 6 and str(data["login"]) != str(message.text):
                number = 0
                data['password'] = message.text
                await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
                await bot.edit_message_text(
                    f'üñ±*Z/5üñ±*\n\n‚ùïÔ∏è|{username}, –æ–±–Ω–æ–≤–∏—Ç–µ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å|‚ùï\n\n‚ñ´Ô∏è*–û—Ç–≤–µ—Ç:* ___–º–æ–π –ø–∞—Ä–æ–ª—å - {len(data["password"]) * "*"}!___',
                    chat_id=message.from_user.id, message_id=data["id_need_2X"], parse_mode=ParseMode.MARKDOWN)
                id_0 = data['id_need_3']
                await delete_messages_before_Nmessage(id_0, message.message_id, message.from_user.id)
                await Registor.s_code.set()
                username = message.from_user.username
                if data.get("appeal") is not None:
                    await bot.edit_message_text(
                        text=text(
                            f'üñ±<b>5/5üñ±</b>\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n'
                            f'‚ñ´<b>Ô∏èÔ∏è–í–∞—à–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ:</b> <code>{data["appeal"]}</code>‚ñ´Ô∏è\n'
                            f'‚ñ´<b>–í–∞—à –ª–æ–≥–∏–Ω:</b> <code>{data["login"]}</code>‚ñ´Ô∏è\n'
                            f'‚ñ´<b>–í–∞—à –ø–∞—Ä–æ–ª—å:</b> <code>{data["password"]}</code>‚ñ´Ô∏è\n\n'
                            f'üìå–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã'),
                        chat_id=message.from_user.id, message_id=id_0,
                        parse_mode='HTML', reply_markup=kb_control)
                else:
                    await bot.edit_message_text(
                        text=text(
                            f'üñ±<b>5/5üñ±</b>\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n'
                            f'‚ñ´<b>–í–∞—à –ª–æ–≥–∏–Ω:</b> <code>{data["login"]}</code>‚ñ´Ô∏è\n'
                            f'‚ñ´<b>–í–∞—à –ø–∞—Ä–æ–ª—å:</b> <code>{data["password"]}</code>‚ñ´Ô∏è\n\n'
                            f'üìå–ü–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤–∞—à–∏ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–∫—Ä—ã—Ç—ã'),
                        chat_id=message.from_user.id, message_id=id_0,
                        parse_mode='HTML', reply_markup=kb_control)
            else:
                    number = number + 1
                    await bot.delete_message(chat_id=message.from_user.id, message_id=message.message_id)
                    if len(message.text) < 6 and str(data["login"]) == str(message.text):
                        pass_log_number = 1
                        reforming_log = InlineKeyboardButton((emojize("üîôÔ∏è–ò–ó–ú–ï–ù–ò–¢–¨ –õ–û–ì–ò–ù")),
                                                              callback_data='reforming_login')
                        reforming_kb = InlineKeyboardMarkup(resize_keyboard=True).row(reforming_log)
                        await bot.edit_message_text(text((
                            f'üñ±*Z/5*üñ±\n\n‚ùïÔ∏è|–ê —Ç–µ–ø–µ—Ä—å, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ø–∞—Ä–æ–ª—å|‚ùï\n\n‚ñ´Ô∏è–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ –ø—è—Ç–∏ —Å–∏–º–≤–æ–ª–æ–≤ –∏ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –ª–æ–≥–∏–Ω–∞‚ñ´Ô∏è\n‚ùïÔ∏è|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                            bold(f' {str(number)}') + (' –∏–∑ 5|‚ùï')), chat_id=message.from_user.id,
                            message_id=data["id_need_2X"], parse_mode=ParseMode.MARKDOWN, reply_markup= reforming_kb)

                    elif len(message.text) < 6:
                        await bot.edit_message_text(text((
                                                         f'üñ±*Z/5*üñ±\n\n‚ùïÔ∏è|–ê —Ç–µ–ø–µ—Ä—å, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ø–∞—Ä–æ–ª—å|‚ùï\n\n‚ñ´Ô∏è–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ –ø—è—Ç–∏ —Å–∏–º–≤–æ–ª–æ–≤‚ñ´Ô∏è\n‚ùïÔ∏è|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                                                     bold(f' {str(number)}') + (' –∏–∑ 5|‚ùï')), chat_id=message.from_user.id,
                                                message_id=data["id_need_2X"], parse_mode=ParseMode.MARKDOWN)

                    elif str(data["login"]) == str(message.text):
                        pass_log_number = 1
                        reforming_log = InlineKeyboardButton((emojize("üîôÔ∏è–ò–ó–ú–ï–ù–ò–¢–¨ –õ–û–ì–ò–ù")),
                                                             callback_data='reforming_login')
                        reforming_kb = InlineKeyboardMarkup(resize_keyboard=True).row(reforming_log)
                        await bot.edit_message_text(text((
                            f'üñ±*Z/5*üñ±\n\n‚ùïÔ∏è|–ê —Ç–µ–ø–µ—Ä—å, {username}, –ø—Ä–∏–¥—É–º–∞–π—Ç–µ —Å–µ–±–µ –ø–∞—Ä–æ–ª—å|‚ùï\n\n‚ñ´Ô∏è–ü—Ä–æ—Å—Ç–∏—Ç–µ, –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –æ—Ç–ª–∏—á–∞—Ç—å—Å—è –æ—Ç –ª–æ–≥–∏–Ω–∞‚ñ´Ô∏è\n‚ùïÔ∏è|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                            bold(f' {str(number)}') + (' –∏–∑ 5|‚ùï')), chat_id=message.from_user.id,
                            message_id=data["id_need_2X"], parse_mode=ParseMode.MARKDOWN, reply_markup= reforming_kb)

                    if number == 5:
                        number = 0
                        global number_for_afisha
                        async with state.proxy() as data:
                            vam = data['id_need']
                        await sto(vam, message.message_id, message.from_user.id, reg_otmena_text_2, regORaut_text,
                                  regORaut_board)
                        await state.finish()
                        await Begin.regORaut.set()
                        number_for_afisha = 0
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        number_for_afisha = 0
        await sto(id_0, message.message_id, message.from_user.id, reg_otmena_text_2, regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()


# reg_20: –Ω–∞–∑–∞–¥ –≤ –º–µ–Ω—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
@dp.callback_query_handler(lambda c: c.data == 'come_adding_menu', state= [Registor.s_code, HelpC.appeal, HelpC.login, HelpC.password])
async def come_adding_menu(callback_query: types.CallbackQuery, state: FSMContext):
    try:
        await Registor.s_code.set()
        await bot.delete_message(chat_id=callback_query.from_user.id, message_id=callback_query.message.message_id)
        async with state.proxy() as data:
            id_0 = data['id_need_3']
            await delete_messages_before_Nmessage(id_0, callback_query.message.message_id, callback_query.from_user.id)
        username = callback_query.from_user.username
        async with state.proxy() as data:
            await bot.edit_message_text((f'üñ±*5/5*üñ±\n\n‚ùîÔ∏è|–í—ã —Å–æ–≥–ª–∞—Å–Ω—ã, {username}, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏|‚ùî\n\n‚ñ´Ô∏è–ò —á—Ç–æ –∂–µ –≤–∞—Å –Ω–µ —É—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç?‚ñ´Ô∏è'),
            chat_id=callback_query.from_user.id, message_id=data['id_need_3'], reply_markup=reforming_kb,
            parse_mode=ParseMode.MARKDOWN)
    except:
        async with state.proxy() as data:
            id_0 = data['id_need']
        global number_for_afisha
        number_for_afisha = 0
        await sto(id_0, callback_query.message.message_id, callback_query.from_user.id, reg_otmena_text_2, regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()



###
# aut_0: –æ—Ç–º–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
@dp.message_handler(text=["üî¥–û–¢–ú–ï–ù–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–òüî¥"], state = [Begin.regORaut, Authorization.login, Authorization.password, Authorization.final])
async def stoppingREG(message: types.Message, state: FSMContext):
    async with state.proxy() as data:
        id_0 = data['aut_mes']
    await sto(id_0, message.message_id, message.from_user.id, aut_otmena_text, regORaut_text,
              regORaut_board)
    await state.finish()
    await Begin.regORaut.set()




# aut_1: –ø—Ä–∏–Ω–∏–º–∞–µ–º –∑–∞—Ö–æ–¥
@dp.callback_query_handler(lambda c: c.data == 'aut', state=Begin.regORaut)
async def loag(callback_query: types.CallbackQuery, state: FSMContext):
    try:
        global number
        aut_mes = await callback_query.message.edit_text((emojize(":airplane:–í–û–ô–¢–ò:airplane:")))
        await state.update_data(aut_mes=int(aut_mes.message_id))
        lg_stop_kb = ReplyKeyboardMarkup(resize_keyboard=True, one_time_keyboard=True).add(
            KeyboardButton("üî¥–û–¢–ú–ï–ù–ê –ê–í–¢–û–†–ò–ó–ê–¶–ò–òüî¥"))
        await callback_query.message.answer((emojize("üîë–ê–í–¢–û–†–ò–ó–ê–¶–ò–Øüîë")), reply_markup= lg_stop_kb)
        await Authorization.login.set()
        await asyncio.sleep(0.2)
        message_log = await bot.send_message(callback_query.from_user.id,
                                             text=(f'‚ô¶Ô∏è*1/2‚ô¶Ô∏è*\n\n‚ùóÔ∏è|–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –ª–æ–≥–∏–Ω|‚ùóÔ∏è'),
                                             parse_mode=ParseMode.MARKDOWN)
        await state.update_data(mes_log=int(message_log.message_id))


        @dp.message_handler(lambda message: message.text, state=Authorization.login)
        async def aut_log(message: types.Message, state: FSMContext):
            global number
            async with state.proxy() as data:
                it_id = data['mes_log']
            conn = sqlite3.connect(f'Day_Plan_db.db', check_same_thread=False)
            cursor = conn.cursor()
            cursor.execute('''SELECT Login FROM All_Users WHERE Login=?''', (str(message.text),))
            rez = cursor.fetchone()
            await message.delete()
            if rez is None:
                number += 1
                await bot.edit_message_text(text((
                    f'‚ô¶Ô∏è*1/2‚ô¶Ô∏è*\n\n‚ùóÔ∏è|–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –ª–æ–≥–∏–Ω|‚ùó\n\nüîªÔ∏è–õ–æ–≥–∏–Ω "{message.text}" –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!üîªÔ∏è\n‚ùó|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                    bold(f' {str(number)}') + (' –∏–∑ 5|‚ùó')), chat_id=message.from_user.id,
                    message_id=it_id, parse_mode=ParseMode.MARKDOWN)
                if number == 5:
                    async with state.proxy() as data:
                        id_0 = data['aut_mes']
                    global number_for_afisha
                    await sto(id_0, message.message_id, message.from_user.id, aut_otmena_text, regORaut_text,
                              regORaut_board)
                    await state.finish()
                    await Begin.regORaut.set()

            else:
                await bot.edit_message_text(text(
                    f'‚ô¶Ô∏è*1/2‚ô¶Ô∏è*\n\n‚ùóÔ∏è|–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –ª–æ–≥–∏–Ω|‚ùó\n\nüîª*–û—Ç–≤–µ—Ç:* ___–º–æ–π –ª–æ–≥–∏–Ω - {message.text}!___'),
                    chat_id=message.from_user.id, message_id=it_id,
                    parse_mode=ParseMode.MARKDOWN)
                async with state.proxy() as data:
                    data['login'] = message.text
                    await Authorization.next()
                    mes_reg = await bot.send_message(message.from_user.id,
                                                 text=(f'‚ô¶Ô∏è*2/2‚ô¶Ô∏è*\n\n‚ùóÔ∏è|–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å|‚ùó'),
                                                 parse_mode=ParseMode.MARKDOWN)
                await state.update_data(mes_reg=int(mes_reg.message_id))

        @dp.message_handler(lambda message: message.text, state=Authorization.password)
        async def aut_reg(message: types.Message, state: FSMContext):
            global number
            async with state.proxy() as data:
                log = data['login']
                it_id = data['mes_reg']
            conn = sqlite3.connect(f'Day_Plan_db.db', check_same_thread=False)
            cursor = conn.cursor()
            cursor.execute('''SELECT Password FROM All_Users WHERE Login=?''', [log])
            rez = cursor.fetchone()
            await message.delete()
            if rez[0] == message.text:

                await bot.edit_message_text(text(
                    f'‚ô¶Ô∏è*2/2‚ô¶Ô∏è*\n\n‚ùóÔ∏è|–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å|‚ùóÔ∏è\n\nüîª*–û—Ç–≤–µ—Ç:* ___–º–æ–π –ø–∞—Ä–æ–ª—å - {len(message.text)*"*"}!___'),
                    chat_id=message.from_user.id, message_id=it_id,
                    parse_mode=ParseMode.MARKDOWN)
                await message.answer((emojize("üîë–ê–í–¢–û–†–ò–ó–ê–¶–ò–Øüîë")), reply_markup=ReplyKeyboardRemove())
                await Authorization.next()
                async with state.proxy() as data:
                    data['aut_mes'] = None
                    data['mes_log'] = None
                    data['mes_reg'] = None
                    number = 0
            else:
                number += 1
                await bot.edit_message_text(text((
                    f'‚ô¶Ô∏è*2/2‚ô¶Ô∏è*\n\n‚ùóÔ∏è|–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å|‚ùó\n\nüîª "{message.text}"  - –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å!üîªÔ∏è\n‚ùó|*–ü–æ–ø—ã—Ç–∫–∞*:'),
                    bold(f' {str(number)}') + (' –∏–∑ 5|‚ùó')), chat_id=message.from_user.id,
                    message_id=it_id, parse_mode=ParseMode.MARKDOWN)
                if number == 5:
                    async with state.proxy() as data:
                        id_0 = data['aut_mes']
                    global number_for_afisha
                    await sto(id_0, message.message_id, message.from_user.id, aut_otmena_text, regORaut_text,
                              regORaut_board)
                    await state.finish()
                    await Begin.regORaut.set()
    except:
        async with state.proxy() as data:
            id_0 = data['aut_mes']
        await sto(id_0, callback_query.message.message_id, callback_query.from_user.id, aut_otmena_text, regORaut_text,
                  regORaut_board)
        await state.finish()
        await Begin.regORaut.set()



if __name__ == '__main__':
    executor.start_polling(dp)
